## 技术选型
- 后端：Python  + Django  + Django REST Framework (DRF)
- 前端：Vue 3 +  Axios + Vite + ==待补充==
- 数据库：MySQL 
- ORM：Django ORM
## 文件结构
~~~
meeting_system/              # 项目根目录
meeting_system/              # 后端
├─ meeting_system/
│ ├─ settings.py             # 核心配置文件
│ ├─ urls.py                 # 主路由配置文件
│ └─ wsgi.py
├─ users/					 # 用户 app
├─ rooms/                    # 会议室 app
├─ reservations/             # 预定 app
└─ manage.py                 # Django 命令行工具入口
~~~
## 设计说明
### 普通用户
前端与后端之间通过请求交互，通用接口返回格式：
```json
{
  "code": 0,
  "msg": "ok",
  "data": {}
}
```

| 字段 | 说明              |
| ---- | ----------------- |
| code | 0 成功，非 0 失败 |
| msg  | 给前端弹窗用      |
| data | 实际数据          |
#### 登录
##### 登录请求
###### 请求格式
- `POST /api/auth/login/`
- 参数 `username` `password`
	- 用户名和密码。
- 成功返回值 `access` `refresh`
	- 这两个字段用于 `JWT` 鉴权。后续请求需在 Header 中携带 `Authorization: Bearer <access>` 。
###### 附加说明
- 代码位置 `meeting_system/users/views.py`
- 账号由管理员在后台手动添加，使用 Django 自带 `User` 模型及权限体系。
- 普通用户与管理员共用用户表，通过权限区分
- ==可继续补充 JWT 相关==
###### 失败情形
- 没有 `username` 和 `password` 对应的用户 -> `用户名或密码错误`
- 管理员账号登录普通用户入口 -> `管理员账户禁止登录`
##### 刷新 `access`
###### 请求格式
- `POST /api/token/refresh/`
- 参数 `refresh`
- 成功返回值 `access`
###### 附加说明
- 代码位置 `meeting_system/meeting_system/urls.py `
- `access` 有效期 30 分钟。 `refresh` 有效期 7 天。
#### 会议室相关
##### 获取可用会议室列表
###### 请求格式
- `GET /api/rooms/list/`
- 返回所有的会议室列表
###### 附加说明
- 代码位置 `meeting_system/rooms/views.py`
#### 预定相关
1. 接口不能成功转换请求中的**所有**参数会返回 `参数格式错误`
2. 接口对请求中的时间参数有统一的初步检验。`validate_date_and_time(reserve_date, start_hour, end_hour)`
	- 包含以下错误：`预约日期不能早于今天` 、`小时必须在 0-24 范围内`、 `结束时间必须晚于开始时间`、 `当天预约开始时间不能早于当前时间`
3. 遇到其他错误返回 `服务器内部错误`
代码位于 `meeting_system/reservations/views.py`
##### 查询可用会议室
###### 请求格式
- `POST /api/reservations/check/`
- 参数：
    - `date`：预约日期（`YYYY-MM-DD`）
    - `start_hour`：开始小时（整数，0–23）
    - `end_hour`：结束小时（整数，1–24）
    - `people`：参会人数
###### 成功返回
- 符合条件的会议室列表
###### 附加说明
- 时间以 **1 小时为最小单位**
- 只能选择 **同一天连续小时**
- 自动排除：
    - 人数不足的会议室
    - 时间段已被占用的会议室
    - 不可预约的会议室
###### 失败情形
- 日期为空 → `日期不能为空`
- 人数 ≤ 0 → `参会人数必须大于 0`
##### 创建预约
###### 请求格式
- `POST /api/reservations/create/`
- 参数：
    - `room_id`：会议室 ID
    - `date`：预约日期
    - `start_hour`：开始小时
    - `end_hour`：结束小时
    - `people`：参会人数
    - `topic`：会议主题
###### 成功返回
- 提示信息：`预约提交成功，等待审批`
###### 附加说明
- 用户身份从 `JWT` 中获取
- 原子性操作
- 新建预约状态固定为 `PENDING（审核中）`
- 创建时系统会再次校验：
    - 时间冲突
    - 人数是否超出会议室容量
    - 会议室是否仍可预约
###### 失败情形
- 会议室不存在或不可预约 → `会议室不存在或不可用`
- 时间段冲突 → `该时间段已被占用`
- 人数超出容量 → `会议室容量不足`
- 缺少某个参数 → `缺少参数: {}`

##### 查询我的预约记录
###### 请求格式
- `GET /api/reservations/my/`
###### 成功返回
- 当前用户的所有预约记录，包括：
    - `PENDING`：审核中
    - `APPROVED`：已通过
    - `REJECTED`：已驳回
    - `CANCELED`：已取消
    - `USED`：已使用
- 每条记录包含：
    - 会议室
    - 日期
    - 时间段
    - 状态
    - 审批时间
    - 驳回原因（如有）
###### 附加说明
- 返回结果按时间倒序
###### 失败情形
- 用户未登录 → `401 未认证`
##### 取消预约
###### 请求格式
- `POST /api/reservations/{id}/cancel`
- 路径参数：
    - `id`：预约 ID
###### 成功返回
- 提示信息：`预约已取消`
###### 附加说明
- 仅预约创建者可取消
- 不需要审批
- 允许取消状态：
    - `PENDING`
    - `APPROVED`
###### 失败情形
- 非本人操作 → `无权取消此预约`
- 状态不可取消（如 USED）→ `当前状态不可取消`
- 预约不存在 → `预约记录不存在`
##### 确认使用
###### 请求格式
- `POST /api/reservations/{id}/confirm`
- 路径参数：
    - `id`：预约 ID
###### 成功返回
- 提示信息：`已确认使用会议室`
###### 附加说明
- 仅预约创建者可操作
- 仅限 `APPROVED` 状态
- 只能在会议开始时间 **前后 1 小时内** 确认
###### 失败情形
- 非本人操作 → `无权确认使用此预约`
- 状态非已审批 → `只有已通过的预约才能确认使用`
- 不在允许时间窗口 → `不在允许确认使用的时间范围内`
### 管理员
#### 💻 User 模型扩展
##### 功能概述
通过继承和内联（`UsersProfileInline`），将自定义的用户扩展信息模型 `UsersProfile` 嵌入到 Django 自带的 `User` 模型的管理员编辑页面中。
##### 主要配置
- **内联显示 (`UsersProfileInline`)**: 使用 `admin.StackedInline` 将 `UsersProfile` 字段堆叠显示在 `User` 编辑页面，实现用户基础信息和扩展信息的一站式管理。
- **自定义 `UserAdmin`**: 继承 `BaseUserAdmin`，并通过 `inlines = (UsersProfileInline,)` 启用内联显示。
- **列表显示**: 在用户列表中显示 **用户名** (`username`) 和 **是否为职员** (`is_staff`)。
- **注册**: 注销原有的 `User` Admin，并用自定义的 `UserAdmin` 重新注册 `User` 模型。
#### 🏢 MeetingRoom 模型管理
##### 功能概述
配置会议室 (`MeetingRoom`) 模型的管理界面，实现列表展示、筛选、搜索、图片预览以及批量操作。
##### 主要配置
- **列表显示 (`list_display`)**: 显示 **名称**、**房号**、**容量**、**面积**、**用途**、**照片预览** 和 **是否可预约** (`is_available`)。
- **筛选器 (`list_filter`)**: 支持按 **是否可预约** (`is_available`) 和 **容量** (`capacity`) 进行筛选。
- **搜索框 (`search_fields`)**: 支持按 **名称** (`name`) 和 **用途** (`usage`) 进行模糊搜索。
- **列表可编辑 (`list_editable`)**: 允许管理员在列表页直接修改 **是否可预约** 状态。
- **图片预览 (`show_photo`)**: 这是一个自定义方法，用于将会议室图片 (`photo`) 以缩略图的形式显示在列表页，并支持点击在新窗口查看大图。
##### 批量操作 (Actions)
- **批量设为可预约 (`make_available`)**: 将选中的会议室的 `is_available` 字段批量设置为 `True`。
- **批量设为不可预约 (`make_unavailable`)**: 将选中的会议室的 `is_available` 字段批量设置为 `False`。
#### 🗓️ Reservation 模型管理 (`admin.py`)
##### 功能概述
配置会议室预约 (`Reservation`) 模型的管理界面，包括复杂的表单校验、自定义列表显示、审批流程动作以及保存钩子。
##### 表单校验 (`ReservationAdminForm`)
##### 📅 时间合法性校验
- **时间范围**: 开始时间和结束时间必须在 **0-24 点** 之间。
- **顺序**: **结束时间** 必须晚于 **开始时间**。
- **日期**: **预约日期** 不能早于 **今天**。
- **当日预约**: 如果是当天预约，**开始时间** 不能早于 **当前小时**。
##### 🚫 状态与时间修改限制
- **会议室状态**: 只有 **可预约** (`is_available=True`) 的会议室才能被预约。
- **已审批/已使用**: 对于状态为 `APPROVED` (已通过) 或 `USED` (已使用) 的预约，**禁止修改日期和时间段**。
##### ❌ 时间冲突检查
- **检查范围**: 检查同一会议室、同一日期下，所有状态为 `PENDING` (审核中)、`APPROVED` (已通过) 或 `USED` (已使用) 的预约。
- **冲突判定**: 新预约的时间段 ($[start, end)$) 与现有预约的时间段有重叠时，判定为冲突，并提示冲突预约的信息。
##### 🔄 状态流转校验 (编辑预约)
- **流转限制**: 状态的改变必须遵循预设的合法路径。
    - `PENDING` → `APPROVED`, `REJECTED`, `CANCELED`
    - `APPROVED` → `USED`, `CANCELED`
    - 其他状态 (如 `REJECTED`, `CANCELED`, `USED`) 不能再流转。
- **驳回理由**: 当状态设为 `REJECTED` (已驳回) 时，必须填写 **驳回理由**。非 `REJECTED` 状态时，自动清空驳回理由。
- **确认使用限制**: 当状态设为 `USED` 时，必须在预约开始时间 **前后 1 小时内**。
##### ✨ 新建预约校验 (管理员代操作)
- **状态限制**: 管理员创建新预约时，状态只能是 **审核中** (`PENDING`) 或 **已通过** (`APPROVED`)。
- **驳回理由**: 创建时不能填写驳回理由。
- **过期审批**: 不能为已过期的日期创建状态为 **已通过** (`APPROVED`) 的预约。
##### 管理界面配置 (`ReservationAdmin`)
- **列表显示 (`list_display`)**: 显示 ID、用户、会议室、日期、**时间段**、主题、**状态（颜色区分）**、审批时间。
- **筛选器**: 按 **状态**、**日期**、**会议室** 筛选。
- **搜索框**: 搜索 **用户名** 和 **主题**。
- **字段集 (`fieldsets`)**: 将字段分组显示为 **预约信息** 和 **审批信息**。
- **只读字段**: **审批时间** (`approve_time`) 为只读。
##### 🎨 自定义列表显示方法
- **`time_range`**: 将 `start_hour` 和 `end_hour` 格式化为 `XX:00 - YY:00` 的时间段显示。
- **`status_colored`**: 根据预约状态使用不同颜色（例如：`PENDING` 用橙色，`APPROVED` 用绿色）高亮显示状态文本。
##### 🛠️ 批量操作 (Actions)
- **审批通过 (`approve_reservations`)**:
    - **限制**: 只对 **审核中** (`PENDING`) 状态的预约生效。
    - **校验**: 会跳过 **已过期** 或 **存在时间冲突** 的预约。
    - **操作**: 将状态更新为 `APPROVED`，并记录 `approve_time`。
- **驳回预约 (`reject_reservations`)**:
    - **限制**: 只对 **审核中** (`PENDING`) 状态的预约生效。
    - **操作**: 将状态更新为 `REJECTED`，设置 `reject_reason` 为“管理员后台驳回”，并记录 `approve_time`。
##### 💾 保存钩子 (`save_model`)
- **新建预约**: 如果状态为 `APPROVED` (管理员代为创建并直接通过)，自动设置 `approve_time`。
- **编辑预约**: 如果状态被修改为 `APPROVED` 或 `REJECTED` 且 `approve_time` 尚未设置，自动记录当前的审批时间。